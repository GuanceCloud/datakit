---
title     : 'RabbitMQ'
summary   : 'Collect RabbitMQ metrics'
tags:
  - 'MESSAGE QUEUES'
  - 'MIDDLEWARE'
__int_icon      : 'icon/rabbitmq'
dashboard :
  - desc  : 'RabbitMQ'
    path  : 'dashboard/en/rabbitmq'
monitor   :
  - desc  : 'RabbitMQ'
    path  : 'monitor/en/rabbitmq'
---


{{.AvailableArchs}}

---

RabbitMQ collector monitors RabbitMQ by collecting data through the plug-in `rabbitmq-management` and can:

- RabbitMQ overview, such as connections, queues, total messages, and so on.
- Track RabbitMQ queue information, such as queue size, consumer count and so on.
- Rack RabbitMQ node information, such as `socket` `mem`.
- Tracking RabbitMQ exchange information such as `message_publish_count`.

## Configuration {#config}

### Preconditions {#reqirement}

- RabbitMQ version >= `3.6.0`; Already tested version:
    - [x] 3.11.x
    - [x] 3.10.x
    - [x] 3.9.x
    - [x] 3.8.x
    - [x] 3.7.x
    - [x] 3.6.x

- Install `rabbitmq`, take `Ubuntu` as an example

    ```shell
    sudo apt-get update
    sudo apt-get install rabbitmq-server
    sudo service rabbitmq-server start
    ```

- Start `REST API plug-ins`

    ```shell
    sudo rabbitmq-plugins enable rabbitmq_management
    ```

- Create user, for example:

    ```shell
    sudo rabbitmqctl add_user monitor <SECRET>
    sudo rabbitmqctl set_permissions  -p / monitor "^aliveness-test$" "^amq\.default$" ".*"
    sudo rabbitmqctl set_user_tags monitor monitoring
    ```

### Collector Configuration {#input-config}
<!-- markdownlint-disable MD046 -->
=== "Host Installation"

    Go to the `conf.d/samples` directory under the DataKit installation directory, copy `{{.InputName}}.conf.sample` and name it `{{.InputName}}.conf`. Examples are as follows:



    ```toml
    {{ CodeBlock .InputSample 4 }}
    ```
    
    After configuration, [restart DataKit](../datakit/datakit-service-how-to.md#manage-service).

=== "Kubernetes"

    The collector can now be turned on by [ConfigMap injection collector configuration](../datakit/datakit-daemonset-deploy.md#configmap-setting).
<!-- markdownlint-enable -->
## Metric {#metric}

For all of the following data collections, the global election tags will added automatically, we can add extra tags in `[inputs.{{.InputName}}.tags]` if needed:

``` toml
 [inputs.{{.InputName}}.tags]
  # some_tag = "some_value"
  # more_tag = "some_other_value"
  # ...
```

{{ range $i, $m := .Measurements }}
{{if eq $m.Type "metric"}}

### `{{$m.Name}}`

{{$m.MarkdownTable}}

{{ end }}
{{ end }}

## Custom Object {#object}

{{ range $i, $m := .Measurements }}

{{if eq $m.Type "custom_object"}}

### `{{$m.Name}}`

{{$m.Desc}}

{{$m.MarkdownTable}}
{{end}}

{{ end }}

## Log Collection {#logging}
<!-- markdownlint-disable MD046 -->
???+ note

    DataKit must be installed on the host where RabbitMQ is located to collect RabbitMQ logs.

To collect the RabbitMQ log, open `files` in RabbitMQ.conf and write to the absolute path of the RabbitMQ log file. For example:

```toml
    [[inputs.rabbitmq]]
      ...
      [inputs.rabbitmq.log]
        files = ["/var/log/rabbitmq/rabbit@your-hostname.log"]
```

When log collection is turned on, a log with a log `source` of `rabbitmq` is generated by default.
<!-- markdownlint-enable -->
### Log Pipeline Function Cut Field Description {#pipeline}

- RabbitMQ universal log cutting

Example of common log text:

```log
2021-05-26 14:20:06.105 [warning] <0.12897.46> rabbitmqctl node_health_check and its HTTP API counterpart are DEPRECATED. See https://www.rabbitmq.com/monitoring.html#health-checks for replacement options.
```

The list of cut fields is as follows:

| Field Name | Field Value                             | Description                         |
| ---    | ---                                | ---                          |
| status | warning                            | Log level                     |
| msg    | <0.12897.46>...replacement options | Log level                     |
| time   | 1622010006000000000                | Nanosecond timestamp (as row protocol time) |
