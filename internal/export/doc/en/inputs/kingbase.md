---
title     : 'Kingbase'
summary   : 'Collect Kingbase metrics'
tags:
  - 'DATABASE'
__int_icon      : 'icon/kingbase'
dashboard :
  - desc  : 'Kingbase'
    path  : 'dashboard/en/kingbase'
monitor   :
  - desc  : 'N/A'
    path  : '-'
---


{{.AvailableArchs}}

---

Kingbase collector can collect the running status index from Kingbase instance.

## Configuration {#config}

### Preconditions {#reqirement}

- Create user

```sql
-- Create monitor user
CREATE USER datakit with password 'datakit';
-- Grant
GRANT sys_monitor TO datakit;
```

- Enable sys_stat_statements extended logging

Edit the `kingbase.conf` configuration file and change the value of `sys_stat_statements.track` to `top`.

```bash
# track statistics SQL statement access, recommended top, default none 
sys_stat_statements.track = 'top'
```

### Collector Configuration {#input-config}

<!-- markdownlint-disable MD046 -->
=== "Host Installation"

    Go to the `conf.d/samples` directory under the DataKit installation directory, copy `{{.InputName}}.conf.sample` and name it `{{.InputName}}.conf`. Examples are as follows:

    ```toml
    {{ CodeBlock .InputSample 4 }}
    ```

    After configuration, [restart DataKit](../datakit/datakit-service-how-to.md#manage-service).

=== "Kubernetes"

    The collector can now be turned on by [ConfigMap Injection Collector Configuration](../datakit/datakit-daemonset-deploy.md#configmap-setting).
<!-- markdownlint-enable -->

## Metric {#metric}

For all of the following data collections, the global election tags will added automatically, we can add extra tags in `[inputs.{{.InputName}}.tags]` if needed:

{{ range $i, $m := .Measurements }}
{{if eq $m.Type "metric"}}

### `{{$m.Name}}`

{{$m.MarkdownTable}}

{{ end }}
{{ end }}

## Custom Object {#object}

{{ range $i, $m := .Measurements }}

{{if eq $m.Type "custom_object"}}

### `{{$m.Name}}`

{{$m.MarkdownTable}}
{{end}}

{{ end }}

## Log Collection {#logging}

- To enable Kingbase runtime logging, configure the Kingbase configuration file `kingbase.conf` in the data directory as follows:

```toml
log_destination = 'stderr'

logging_collector = on
log_directory = 'sys_log'
```

- The Kingbase collector does not have log collection enabled by default. You can open `files` in `conf.d/db/kingbase.conf`  and write to the absolute path of the Kingbase log file. For example:

```toml
[[inputs.kingbase]]

  ...

  [inputs.kingbase.log]
  files = ["/tmp/kingbase.log"]
```

When log collection is turned on, a log with a log `source` of `kingbase` is generated by default.

**Notices:**

- Log collection only supports logs on hosts where DataKit is installed.

### Log Pipeline Cut {#pipeline}

The original log is

``` log
2025-06-17 13:07:10.952 UTC [999] ERROR:  relation "sys_stat_activity" does not exist at character 240
```

Description of the cut field:

| Field name         | Field Value                                                      | Description                                                    |
| ---                | ---                                                              | ---                                                            |
| `msg`              | `relation "sys_stat_activity" does not exist at character 240`   | Log content                                                    |
| `db_name`          | `test`                                                           | Database accessed                                              |
| `process_id`       | `999`                                                            | The client process ID of the current connection                |
| `status`           | `ERROR`                                                          | Current log level (LOG,ERROR,FATAL,PANIC,WARNING,NOTICE,INFO)  |
| `time`             | `1750136961776000000`                                            | Log generation time                                            |
