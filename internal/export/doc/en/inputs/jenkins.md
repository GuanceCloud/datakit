---
title     : 'Jenkins'
summary   : 'Collect Jenkins metrics and logs'
tags:
  - 'JENKINS'
  - 'CI/CD'
__int_icon      : 'icon/jenkins'
dashboard :
  - desc  : 'Jenkins'
    path  : 'dashboard/en/jenkins'
monitor   :
  - desc  : 'Jenkins'
    path  : 'monitor/en/jenkins'
---

{{.AvailableArchs}}

---

The Jenkins collector monitors Jenkins through plugin `Metrics` data collection, including but not limited to the number of tasks, system cpu usage, `jvm cpu` usage, and so on

## Configuration {#config}

### Preconditions {#requirements}

- JenKins version >= `2.332.1`; Already tested version:
    - [x] 2.332.1

- Install JenKins [see here](https://www.jenkins.io/doc/book/installing/){:target="_blank"}
- Download the `Metric` plug-in, [management plug-in page](https://www.jenkins.io/doc/book/managing/plugins/){:target="_blank"},[Metric plug-in page](https://plugins.jenkins.io/metrics/){:target="_blank"}
- Generate `Metric Access keys` on the JenKins administration page `your_manage_host/configure`

### Collector Configuration {#input-config}

<!-- markdownlint-disable MD046 -->
=== "Host Installation"

    Go to the `conf.d/jenkins` directory under the DataKit installation directory, copy `jenkins.conf.sample` and name it `jenkins.conf`. Examples are as follows:
    
    ```toml
    {{ CodeBlock .InputSample 4 }}
    ```
    
    Once configured, [restart DataKit](../datakit/datakit-service-how-to.md#manage-service).

=== "Kubernetes"

    The collector can now be turned on by [ConfigMap Injection Collector Configuration](../datakit/datakit-daemonset-deploy.md#configmap-setting).
<!-- markdownlint-enable -->

### Jenkins CI Visibility {#ci-visibility}

The Jenkins collector can realize CI visualization by receiving the CI Event from the Jenkins Datadog plugin.

Jenkins CI Visibility opening method:

- Ensure that the Jenkins CI Visibility feature is turned on in the configuration file and the listening port number is configured (such as `:9539`), restart Datakit;
- Install [Jenkins Datadog plugin](https://plugins.jenkins.io/datadog/){:target="_blank"}  in Jenkins;
- Select `Use the Datadog Agent to report to Datadog (recommended)` in Manage Jenkins > Configure System > Datadog Plugin and configure `Agent Host` as the Datakit IP address. Both `DogStatsD Port` and `Traces Collection Port` are configured to the port number configured in the Jenkins collector configuration file above, such as `9539`(do not add `:`);
- Check `Enable CI Visibility`ï¼›
- Click `Save` to Save the settings.

After configuration, Jenkins can send CI events to Datakit through Datadog Plugin.

## Metric {#metric}

For all of the following data collections, the global election tags will added automatically, we can add extra tags in `[inputs.{{.InputName}}.tags]` if needed:

``` toml
[inputs.{{.InputName}}.tags]
# some_tag = "some_value"
# more_tag = "some_other_value"
# ...
```

You can specify additional tags for the Jenkins CI Event in the configuration by `[inputs.{{.InputName}}.ci_extra_tags]`:

```toml
[inputs.{{.InputName}}.ci_extra_tags]
# some_tag = "some_value"
# more_tag = "some_other_value"
```

{{ range $i, $m := .Measurements }}

### `{{$m.Name}}`

- Tags

{{$m.TagsMarkdownTable}}

- Metrics

{{$m.FieldsMarkdownTable}}

{{ end }}


## Log Collection {#logging}

To collect the JenKins log, open `files` in *{{.InputName}}.conf* and write to the absolute path of the JenKins log file. For example:

```toml
    [[inputs.JenKins]]
      ...
      [inputs.JenKins.log]
        files = ["/var/log/jenkins/jenkins.log"]
```


When log collection is turned on, a log with a log `source` of `jenkins` is generated by default.

>Note: DataKit must be installed on the host where JenKins is located to collect JenKins logs.

### Log Pipeline Feature Cut Field Description {#pipeline}

- JenKins Universal Log Cutting

Example of common log text:

```log
2021-05-18 03:08:58.053+0000 [id=32] INFO jenkins.InitReactorRunner$1#onAttained: Started all plugins
```

The list of cut fields is as follows:

| Field Name | Field Value              | Description                         |
| ---    | ---                 | ---                          |
| status | info                | log level                     |
| id     | 32                  | id                           |
| time   | 1621278538000000000 | Nanosecond timestamp (as row protocol time) |
