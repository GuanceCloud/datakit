# conf/redis-cluster-1-tls.conf
# Redis 集群节点 1 - TLS 配置

# 监听所有接口
bind 192.168.139.162
# 禁用非 TLS 端口
port 0
tls-port 7001
cluster-port 17001

# 开启集群模式
cluster-enabled yes

# 集群的配置文件
cluster-config-file nodes.conf

# 集群节点超时时间（毫秒）
cluster-node-timeout 5000

# 开启 AOF 持久化
appendonly yes

# 内存配置
maxmemory 500mb
maxmemory-policy allkeys-lfu

# 慢查询日志
slowlog-log-slower-than 5000
slowlog-max-len 1024

# 密码认证
requirepass abc123456
masterauth abc123456

# ====== TLS 配置 ======
# CA 证书
tls-ca-cert-file /tls/ca-cert.pem

# 服务器证书和私钥
tls-cert-file /tls/redis-server-cert.pem
tls-key-file /tls/redis-server-key.pem

# DH 参数文件（可选，如果不设置 Redis 会使用内置的）
# tls-dh-params-file /tls/redis.dh

# 客户端认证模式
# no: 不需要客户端证书
# optional: 客户端可以提供证书，但不是必需的
# yes: 需要客户端证书
tls-auth-clients no

# 集群节点间也使用 TLS
tls-cluster yes

# TLS 复制连接
tls-replication yes

# 支持的 TLS 协议版本
tls-protocols "TLSv1.2 TLSv1.3"

# 密码套件（可选，留空使用默认）
# tls-ciphers DEFAULT:!MEDIUM

# 优先使用服务器端的密码套件
tls-prefer-server-ciphers yes

# TLS 会话缓存
tls-session-caching yes
tls-session-cache-size 20480
tls-session-cache-timeout 300

