# Redis 集群模式 - 多版本测试（不同端口，可同时运行）
# 使用方法：docker-compose -f docker-compose-cluster-multi-version.yml up -d

services:
  # ===== Redis 7.0.11 Cluster (7001-7006) =====
  redis-7-node-1:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-cluster-7-node-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7001
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-7-node-1-data:/data

  redis-7-node-2:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-cluster-7-node-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7002
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-7-node-2-data:/data

  redis-7-node-3:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-cluster-7-node-3
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7003
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-7-node-3-data:/data

  redis-7-node-4:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-cluster-7-node-4
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7004
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-7-node-4-data:/data

  redis-7-node-5:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-cluster-7-node-5
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7005
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-7-node-5-data:/data

  redis-7-node-6:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-cluster-7-node-6
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7006
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-7-node-6-data:/data

  redis-7-cluster-creator:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-cluster-7-creator
    network_mode: host
    command: >
      sh -c '
        for port in 7001 7002 7003 7004 7005 7006; do
          until redis-cli -h 192.168.139.162 -p $$port -a abc123456 PING 2>/dev/null | grep -q PONG; do
            sleep 1;
          done;
        done;
        redis-cli --cluster create 192.168.139.162:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 --cluster-yes -a abc123456;
      '
    depends_on:
      - redis-7-node-1
      - redis-7-node-2
      - redis-7-node-3
      - redis-7-node-4
      - redis-7-node-5
      - redis-7-node-6

  # ===== Redis 6.2.12 Cluster (7101-7106) =====
  redis-6.2-node-1:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-cluster-6.2-node-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7101
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.2-node-1-data:/data

  redis-6.2-node-2:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-cluster-6.2-node-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7102
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.2-node-2-data:/data

  redis-6.2-node-3:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-cluster-6.2-node-3
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7103
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.2-node-3-data:/data

  redis-6.2-node-4:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-cluster-6.2-node-4
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7104
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.2-node-4-data:/data

  redis-6.2-node-5:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-cluster-6.2-node-5
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7105
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.2-node-5-data:/data

  redis-6.2-node-6:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-cluster-6.2-node-6
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7106
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.2-node-6-data:/data

  redis-6.2-cluster-creator:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-cluster-6.2-creator
    network_mode: host
    command: >
      sh -c '
        for port in 7101 7102 7103 7104 7105 7106; do
          until redis-cli -h 192.168.139.162 -p $$port -a abc123456 PING 2>/dev/null | grep -q PONG; do
            sleep 1;
          done;
        done;
        redis-cli --cluster create 192.168.139.162:7101 127.0.0.1:7102 127.0.0.1:7103 127.0.0.1:7104 127.0.0.1:7105 127.0.0.1:7106 --cluster-replicas 1 --cluster-yes -a abc123456;
      '
    depends_on:
      - redis-6.2-node-1
      - redis-6.2-node-2
      - redis-6.2-node-3
      - redis-6.2-node-4
      - redis-6.2-node-5
      - redis-6.2-node-6

  # ===== Redis 6.0.8 Cluster (7201-7206) =====
  redis-6.0-node-1:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-cluster-6.0-node-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7201
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.0-node-1-data:/data

  redis-6.0-node-2:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-cluster-6.0-node-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7202
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.0-node-2-data:/data

  redis-6.0-node-3:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-cluster-6.0-node-3
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7203
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.0-node-3-data:/data

  redis-6.0-node-4:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-cluster-6.0-node-4
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7204
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.0-node-4-data:/data

  redis-6.0-node-5:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-cluster-6.0-node-5
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7205
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.0-node-5-data:/data

  redis-6.0-node-6:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-cluster-6.0-node-6
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7206
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-6.0-node-6-data:/data

  redis-6.0-cluster-creator:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-cluster-6.0-creator
    network_mode: host
    command: >
      sh -c '
        for port in 7201 7202 7203 7204 7205 7206; do
          until redis-cli -h 192.168.139.162 -p $$port -a abc123456 PING 2>/dev/null | grep -q PONG; do
            sleep 1;
          done;
        done;
        redis-cli --cluster create 192.168.139.162:7201 127.0.0.1:7202 127.0.0.1:7203 127.0.0.1:7204 127.0.0.1:7205 127.0.0.1:7206 --cluster-replicas 1 --cluster-yes -a abc123456;
      '
    depends_on:
      - redis-6.0-node-1
      - redis-6.0-node-2
      - redis-6.0-node-3
      - redis-6.0-node-4
      - redis-6.0-node-5
      - redis-6.0-node-6

  # ===== Redis 5.0.14 Cluster (7301-7306) =====
  redis-5-node-1:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-cluster-5-node-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7301
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-5-node-1-data:/data

  redis-5-node-2:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-cluster-5-node-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7302
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-5-node-2-data:/data

  redis-5-node-3:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-cluster-5-node-3
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7303
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-5-node-3-data:/data

  redis-5-node-4:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-cluster-5-node-4
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7304
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-5-node-4-data:/data

  redis-5-node-5:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-cluster-5-node-5
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7305
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-5-node-5-data:/data

  redis-5-node-6:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-cluster-5-node-6
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7306
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-5-node-6-data:/data

  redis-5-cluster-creator:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-cluster-5-creator
    network_mode: host
    command: >
      sh -c '
        for port in 7301 7302 7303 7304 7305 7306; do
          until redis-cli -h 192.168.139.162 -p $$port -a abc123456 PING 2>/dev/null | grep -q PONG; do
            sleep 1;
          done;
        done;
        redis-cli --cluster create 192.168.139.162:7301 127.0.0.1:7302 127.0.0.1:7303 127.0.0.1:7304 127.0.0.1:7305 127.0.0.1:7306 --cluster-replicas 1 --cluster-yes -a abc123456;
      '
    depends_on:
      - redis-5-node-1
      - redis-5-node-2
      - redis-5-node-3
      - redis-5-node-4
      - redis-5-node-5
      - redis-5-node-6

  # ===== Redis 4.0.14 Cluster (7401-7406) =====
  redis-4-node-1:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-cluster-4-node-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7401
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-4-node-1-data:/data

  redis-4-node-2:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-cluster-4-node-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7402
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-4-node-2-data:/data

  redis-4-node-3:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-cluster-4-node-3
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7403
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-4-node-3-data:/data

  redis-4-node-4:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-cluster-4-node-4
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7404
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-4-node-4-data:/data

  redis-4-node-5:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-cluster-4-node-5
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7405
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-4-node-5-data:/data

  redis-4-node-6:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-cluster-4-node-6
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 7406
      --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-cluster-4-node-6-data:/data

  redis-4-cluster-creator:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-cluster-4-creator
    network_mode: host
    command: >
      sh -c '
        for port in 7401 7402 7403 7404 7405 7406; do
          until redis-cli -h 192.168.139.162 -p $$port -a abc123456 PING 2>/dev/null | grep -q PONG; do
            sleep 1;
          done;
        done;
        redis-cli --cluster create 192.168.139.162:7401 127.0.0.1:7402 127.0.0.1:7403 127.0.0.1:7404 127.0.0.1:7405 127.0.0.1:7406 --cluster-replicas 1 --cluster-yes -a abc123456;
      '
    depends_on:
      - redis-4-node-1
      - redis-4-node-2
      - redis-4-node-3
      - redis-4-node-4
      - redis-4-node-5
      - redis-4-node-6

volumes:
  redis-cluster-7-node-1-data:
  redis-cluster-7-node-2-data:
  redis-cluster-7-node-3-data:
  redis-cluster-7-node-4-data:
  redis-cluster-7-node-5-data:
  redis-cluster-7-node-6-data:
  redis-cluster-6.2-node-1-data:
  redis-cluster-6.2-node-2-data:
  redis-cluster-6.2-node-3-data:
  redis-cluster-6.2-node-4-data:
  redis-cluster-6.2-node-5-data:
  redis-cluster-6.2-node-6-data:
  redis-cluster-6.0-node-1-data:
  redis-cluster-6.0-node-2-data:
  redis-cluster-6.0-node-3-data:
  redis-cluster-6.0-node-4-data:
  redis-cluster-6.0-node-5-data:
  redis-cluster-6.0-node-6-data:
  redis-cluster-5-node-1-data:
  redis-cluster-5-node-2-data:
  redis-cluster-5-node-3-data:
  redis-cluster-5-node-4-data:
  redis-cluster-5-node-5-data:
  redis-cluster-5-node-6-data:
  redis-cluster-4-node-1-data:
  redis-cluster-4-node-2-data:
  redis-cluster-4-node-3-data:
  redis-cluster-4-node-4-data:
  redis-cluster-4-node-5-data:
  redis-cluster-4-node-6-data:
