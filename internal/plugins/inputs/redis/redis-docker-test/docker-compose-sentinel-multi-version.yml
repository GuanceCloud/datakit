# Redis 哨兵模式 - 多版本测试（不同端口，可同时运行）
# 使用方法：docker-compose -f docker-compose-sentinel-multi-version.yml up -d

services:
  # ===== Redis 7.0.11 哨兵集群 (Redis: 6379/6479/6579, Sentinel: 26379/26479/26579) =====
  redis-7-master:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-sentinel-7-master
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6379
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-7-master-data:/data

  redis-7-slave-1:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-sentinel-7-slave-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6479
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6379
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-7-slave-1-data:/data
    depends_on:
      - redis-7-master

  redis-7-slave-2:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-sentinel-7-slave-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6579
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6379
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-7-slave-2-data:/data
    depends_on:
      - redis-7-master

  sentinel-7-1:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-sentinel-7-1
    network_mode: host
    command: >
      sh -c '
        echo "port 26379" > /tmp/sentinel.conf &&
        echo "requirepass sentinel123456" >> /tmp/sentinel.conf &&
        echo "sentinel sentinel-pass sentinel123456" >> /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-7 192.168.139.162 6379 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-7 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-7 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-7 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-7 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-7-master
      - redis-7-slave-1
      - redis-7-slave-2

  sentinel-7-2:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-sentinel-7-2
    network_mode: host
    command: >
      sh -c '
        echo "port 26479" > /tmp/sentinel.conf &&
        echo "requirepass sentinel123456" >> /tmp/sentinel.conf &&
        echo "sentinel sentinel-pass sentinel123456" >> /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-7 192.168.139.162 6379 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-7 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-7 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-7 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-7 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-7-master
      - redis-7-slave-1
      - redis-7-slave-2

  sentinel-7-3:
    image: 'hub.cloudcarex.com/redis:7.0.11'
    container_name: redis-sentinel-7-3
    network_mode: host
    command: >
      sh -c '
        echo "port 26579" > /tmp/sentinel.conf &&
        echo "requirepass sentinel123456" >> /tmp/sentinel.conf &&
        echo "sentinel sentinel-pass sentinel123456" >> /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-7 192.168.139.162 6379 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-7 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-7 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-7 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-7 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-7-master
      - redis-7-slave-1
      - redis-7-slave-2

  # ===== Redis 6.2.12 哨兵集群 (Redis: 6380/6480/6580, Sentinel: 26380/26480/26580) =====
  redis-6.2-master:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-sentinel-6.2-master
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6380
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-6.2-master-data:/data

  redis-6.2-slave-1:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-sentinel-6.2-slave-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6480
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6380
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-6.2-slave-1-data:/data
    depends_on:
      - redis-6.2-master

  redis-6.2-slave-2:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-sentinel-6.2-slave-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6580
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6380
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-6.2-slave-2-data:/data
    depends_on:
      - redis-6.2-master

  sentinel-6.2-1:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-sentinel-6.2-1
    network_mode: host
    command: >
      sh -c '
        echo "port 26380" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-6.2 192.168.139.162 6380 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-6.2 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-6.2 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-6.2 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-6.2 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-6.2-master
      - redis-6.2-slave-1
      - redis-6.2-slave-2

  sentinel-6.2-2:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-sentinel-6.2-2
    network_mode: host
    command: >
      sh -c '
        echo "port 26480" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-6.2 192.168.139.162 6380 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-6.2 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-6.2 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-6.2 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-6.2 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-6.2-master
      - redis-6.2-slave-1
      - redis-6.2-slave-2

  sentinel-6.2-3:
    image: 'hub.cloudcarex.com/redis:6.2.12'
    container_name: redis-sentinel-6.2-3
    network_mode: host
    command: >
      sh -c '
        echo "port 26580" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-6.2 192.168.139.162 6380 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-6.2 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-6.2 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-6.2 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-6.2 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-6.2-master
      - redis-6.2-slave-1
      - redis-6.2-slave-2

  # ===== Redis 6.0.8 哨兵集群 (Redis: 6381/6481/6581, Sentinel: 26381/26481/26581) =====
  redis-6.0-master:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-sentinel-6.0-master
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6381
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-6.0-master-data:/data

  redis-6.0-slave-1:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-sentinel-6.0-slave-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6481
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6381
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-6.0-slave-1-data:/data
    depends_on:
      - redis-6.0-master

  redis-6.0-slave-2:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-sentinel-6.0-slave-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6581
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6381
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-6.0-slave-2-data:/data
    depends_on:
      - redis-6.0-master

  sentinel-6.0-1:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-sentinel-6.0-1
    network_mode: host
    command: >
      sh -c '
        echo "port 26381" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-6.0 192.168.139.162 6381 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-6.0 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-6.0 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-6.0 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-6.0 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-6.0-master
      - redis-6.0-slave-1
      - redis-6.0-slave-2

  sentinel-6.0-2:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-sentinel-6.0-2
    network_mode: host
    command: >
      sh -c '
        echo "port 26481" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-6.0 192.168.139.162 6381 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-6.0 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-6.0 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-6.0 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-6.0 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-6.0-master
      - redis-6.0-slave-1
      - redis-6.0-slave-2

  sentinel-6.0-3:
    image: 'hub.cloudcarex.com/redis:6.0.8'
    container_name: redis-sentinel-6.0-3
    network_mode: host
    command: >
      sh -c '
        echo "port 26581" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-6.0 192.168.139.162 6381 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-6.0 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-6.0 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-6.0 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-6.0 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-6.0-master
      - redis-6.0-slave-1
      - redis-6.0-slave-2

  # ===== Redis 5.0.14 哨兵集群 (Redis: 6382/6482/6582, Sentinel: 26382/26482/26582) =====
  redis-5-master:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-sentinel-5-master
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6382
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-5-master-data:/data

  redis-5-slave-1:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-sentinel-5-slave-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6482
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6382
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-5-slave-1-data:/data
    depends_on:
      - redis-5-master

  redis-5-slave-2:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-sentinel-5-slave-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6582
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6382
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-5-slave-2-data:/data
    depends_on:
      - redis-5-master

  sentinel-5-1:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-sentinel-5-1
    network_mode: host
    command: >
      sh -c '
        echo "port 26382" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-5 192.168.139.162 6382 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-5 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-5 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-5 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-5 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-5-master
      - redis-5-slave-1
      - redis-5-slave-2

  sentinel-5-2:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-sentinel-5-2
    network_mode: host
    command: >
      sh -c '
        echo "port 26482" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-5 192.168.139.162 6382 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-5 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-5 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-5 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-5 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-5-master
      - redis-5-slave-1
      - redis-5-slave-2

  sentinel-5-3:
    image: 'hub.cloudcarex.com/redis:5.0.14'
    container_name: redis-sentinel-5-3
    network_mode: host
    command: >
      sh -c '
        echo "port 26582" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-5 192.168.139.162 6382 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-5 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-5 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-5 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-5 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-5-master
      - redis-5-slave-1
      - redis-5-slave-2

  # ===== Redis 4.0.14 哨兵集群 (Redis: 6383/6483/6583, Sentinel: 26383/26483/26583) =====
  redis-4-master:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-sentinel-4-master
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6383
      --requirepass abc123456 --masterauth abc123456
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-4-master-data:/data

  redis-4-slave-1:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-sentinel-4-slave-1
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6483
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6383
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-4-slave-1-data:/data
    depends_on:
      - redis-4-master

  redis-4-slave-2:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-sentinel-4-slave-2
    network_mode: host
    command: >
      redis-server --bind 192.168.139.162 --port 6583
      --requirepass abc123456 --masterauth abc123456 --slaveof 192.168.139.162 6383
      --maxmemory 500mb --maxmemory-policy allkeys-lfu
      --slowlog-log-slower-than 5000 --slowlog-max-len 1024 --appendonly yes
    volumes:
      - redis-sentinel-4-slave-2-data:/data
    depends_on:
      - redis-4-master

  sentinel-4-1:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-sentinel-4-1
    network_mode: host
    command: >
      sh -c '
        echo "port 26383" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-4 192.168.139.162 6383 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-4 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-4 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-4 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-4 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-4-master
      - redis-4-slave-1
      - redis-4-slave-2

  sentinel-4-2:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-sentinel-4-2
    network_mode: host
    command: >
      sh -c '
        echo "port 26483" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-4 192.168.139.162 6383 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-4 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-4 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-4 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-4 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-4-master
      - redis-4-slave-1
      - redis-4-slave-2

  sentinel-4-3:
    image: 'hub.cloudcarex.com/redis:4.0.14'
    container_name: redis-sentinel-4-3
    network_mode: host
    command: >
      sh -c '
        echo "port 26583" > /tmp/sentinel.conf &&
        echo "sentinel monitor mymaster-4 192.168.139.162 6383 2" >> /tmp/sentinel.conf &&
        echo "sentinel auth-pass mymaster-4 abc123456" >> /tmp/sentinel.conf &&
        echo "sentinel down-after-milliseconds mymaster-4 5000" >> /tmp/sentinel.conf &&
        echo "sentinel parallel-syncs mymaster-4 1" >> /tmp/sentinel.conf &&
        echo "sentinel failover-timeout mymaster-4 10000" >> /tmp/sentinel.conf &&
        redis-sentinel /tmp/sentinel.conf
      '
    depends_on:
      - redis-4-master
      - redis-4-slave-1
      - redis-4-slave-2

volumes:
  redis-sentinel-7-master-data:
  redis-sentinel-7-slave-1-data:
  redis-sentinel-7-slave-2-data:
  redis-sentinel-6.2-master-data:
  redis-sentinel-6.2-slave-1-data:
  redis-sentinel-6.2-slave-2-data:
  redis-sentinel-6.0-master-data:
  redis-sentinel-6.0-slave-1-data:
  redis-sentinel-6.0-slave-2-data:
  redis-sentinel-5-master-data:
  redis-sentinel-5-slave-1-data:
  redis-sentinel-5-slave-2-data:
  redis-sentinel-4-master-data:
  redis-sentinel-4-slave-1-data:
  redis-sentinel-4-slave-2-data:
